<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title> Ø§Ø¹Ø²Ø§Ù… â€” Ú†Ù¾ØªØ± 1</title>
<style>
:root{
  --bg:#0e0e0e;--panel:#171717;--muted:#9aa0a6;--accent:#4CAF50;
  --card:#1f1f1f;--text:#eaeaea;
}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Tahoma,system-ui,Segoe UI,Roboto;display:flex;align-items:center;justify-content:center}
.container{width:95%;max-width:860px;padding:20px;border-radius:12px;background:linear-gradient(180deg,#121212,#151515);box-shadow:0 10px 40px rgba(0,0,0,.6)}
h1{text-align:center;margin:6px 0 18px;font-size:22px}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;gap:10px;flex-wrap:wrap}
.muted{color:var(--muted);font-size:13px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:14px}
.card{background:var(--card);padding:14px;border-radius:10px;text-align:center;cursor:pointer;user-select:none;transition:transform .14s,box-shadow .14s}
.card:hover{transform:translateY(-6px)}
.card.locked{background:#272727;color:var(--muted);cursor:not-allowed;transform:none}
.card.active{background:linear-gradient(90deg,var(--accent),#2fa664);color:#05120a;font-weight:700}
@media(max-width:860px){.grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:420px){.grid{grid-template-columns:1fr}}
.story-area{display:none;padding:16px;background:#0f0f0f;border-radius:10px;min-height:360px}
#chapterLabel{opacity:.85;margin-bottom:8px;font-size:14px}
#textBox{white-space:pre-wrap;line-height:1.7;font-size:17px;min-height:220px;max-height:56vh;overflow:auto;padding-right:6px}
.choices{margin-top:14px;display:flex;flex-direction:column;gap:10px}
.choice{padding:10px;border-radius:10px;background:#2b2b2b;text-align:center;cursor:pointer;transition:transform .12s,opacity .12s}
.choice:hover{transform:translateY(-4px)}
.controls{display:flex;gap:10px;justify-content:flex-start;margin-top:14px;flex-wrap:wrap}
.btn{background:#222;padding:8px 12px;border-radius:8px;cursor:pointer;border:1px solid rgba(255,255,255,.03)}
.small{font-size:13px;color:var(--muted)}
.footer{margin-top:10px;text-align:center;color:var(--muted);font-size:13px}
.end-badge{display:inline-block;padding:6px 10px;border-radius:8px;background:#1b1b1b;color:var(--muted)}
</style>
</head>
<body>
  <div class="container" role="application" aria-live="polite">
    <h1>Ø§Ø¹Ø²Ø§Ù…  â€” Ø§Ù†ØªØ®Ø§Ø¨ Ú†Ù¾ØªØ±</h1>

    <!-- Ù…Ù†ÙˆÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú†Ù¾ØªØ± -->
    <div id="selectView">
      <div class="topbar">
        <div class="muted">ÙÙ‚Ø· Ú†Ù¾ØªØ± Û± ÙØ¹Ø§Ù„ Ø§Ø³Øª â€” Ø¨Ù‚ÛŒÙ‡ Â«Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒÂ»</div>
        <div class="muted">Ù†ÙˆÛŒØ³Ù†Ø¯Ú¯Ø§Ù†: Ø­Ø§Ù…Ø¯ Ù…ÛŒØ§Ø²Ø§Ú©ÛŒ Ùˆ Ù…Ù‡Ø±Ø´Ø§Ø¯ ÙØ±Ø§Ø³ØªÛŒ</div>
      </div>

      <div class="grid" id="chapGrid">
        <div class="card active" data-ch="1">Ú†Ù¾ØªØ± 1</div>
        <div class="card locked" data-ch="2">Ú†Ù¾ØªØ± 2<br><small>Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ</small></div>
        <div class="card locked" data-ch="3">Ú†Ù¾ØªØ± 3<br><small>Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ</small></div>
        <div class="card locked" data-ch="4">Ú†Ù¾ØªØ± 4<br><small>Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ</small></div>
        <div class="card locked" data-ch="5">Ú†Ù¾ØªØ± 5<br><small>Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ</small></div>
        <div class="card locked" data-ch="6">Ú†Ù¾ØªØ± 6<br><small>Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ</small></div>
        <div class="card locked" data-ch="7">Ú†Ù¾ØªØ± 7<br><small>Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ</small></div>
        <div class="card locked" data-ch="8">Ú†Ù¾ØªØ± 8<br><small>Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ</small></div>
      </div>

      <div class="muted">Ø±ÙˆÛŒ Â«Ú†Ù¾ØªØ± 1Â» Ú©Ù„ÛŒÚ© Ú©Ù† ØªØ§ ÙˆØ§Ø±Ø¯ Ø¯Ø§Ø³ØªØ§Ù†Ø´ Ø¨Ø´ÛŒ.</div>
    </div>

    <!-- Ù†Ù…Ø§ÛŒ Ø¯Ø§Ø³ØªØ§Ù† -->
    <div id="storyView" class="story-area" aria-hidden="true">
      <div id="chapterLabel"></div>
      <div id="textBox" tabindex="0"></div>

      <div class="choices" id="choices"></div>

      <div class="controls">
        <div class="btn" id="backBtn">âŸµ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ</div>
        <div class="btn" id="skipBtn">â© Ù¾Ø±Ø´ ØªØ§ÛŒÙ¾</div>
        <div class="btn" id="saveBtn">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</div>
      </div>
      <div class="footer"><span class="end-badge">Ù¾Ø§ÛŒØ§Ù† Ù‚Ø³Ù…Øª 1</span></div>
    </div>
  </div>

<script>
// ===== story engine for Chapter 1 (based on user's draft) =====

// STORY NODES
// Keys represent scenes. Choices -> goto another key.
// We'll use branching according to user's text: initial choice -> two main branches.
// Some choices change only small dialogue but still included.

const story = {
  // START
  "chapter1_start": {
    chapter:1,
    text: "Ø¨Ø§Ø±ÙˆÙ† Ø´Ø¯ÛŒØ¯ ÙˆØ§ØªØ±Ù„ÙÙ†Ø¯ Ù…ÛŒâ€ŒØ¨Ø§Ø±ÛŒØ¯ Ùˆ Ù¾Ù†Ø¬Ø§Ù‡ Ùˆ Ø¯ÙˆÙ…ÛŒÙ† Ù†Ø® Ø³ÛŒÚ¯Ø§Ø± Ø¯Ø± Ú†Ù‡Ù„ Ùˆ Ù‡Ø´ØªÙ…ÛŒÙ† Ø³Ø§Ø¹ØªÛŒ Ú©Ù‡ Ù…Ø±Ø´Ø§Øª Ù†Ø®ÙˆØ§Ø¨ÛŒØ¯Ù‡ Ø¨ÙˆØ¯... Ù…ÛŒÙ…ÙˆÙ†Ø´ Ø±Ø§ Ù†ÙˆØ§Ø²Ø´ Ù…ÛŒâ€ŒÚ©Ø±Ø¯ Ùˆ Ø³ÛŒÚ¯Ø§Ø± Ø±Ø§ Ø±ÙˆØ´Ù† Ù…ÛŒâ€ŒÚ©Ø±Ø¯. Ø§ÙÚ©Ø§Ø±Ø´ Ù¾Ø±ÛŒØ´Ø§Ù† Ø¨ÙˆØ¯. Ú†Ø§Ù‚Ùˆ Ø±Ø§ Ø§Ø² Ø±ÙˆÛŒ Ù…ÛŒØ² Ø¨Ø±Ø¯Ø§Ø´Øª.",
    choices: [
      { label: "Ø§Ù‚Ø¯Ø§Ù… Ø¨Ù‡ Ø®ÙˆØ¯Ú©Ø´ÛŒ", goto: "suicide_intervene" },
      { label: "Ø¨Ø§ Ø®Ø´Ù… Ø¨Ù‡ Ø³Ù…Øª Ø¯Ø± Ø¨Ø±Ùˆ", goto: "angry_door" }
    ]
  },

  // ----- Branch A: Suicide attempt interrupted (Ù…Ù‡Ø±Ø¨Ø§Ù†Ø§Ù†Ù‡ path) -----
  "suicide_intervene": {
    chapter:1,
    text: `Ø¯Ø®ØªØ±ÛŒ Ø¨Ø§ Ú©Øª Ù…Ø´Ú©ÛŒ Ùˆ Ù…ÙˆÙ‡Ø§ÛŒ ÙØ±ØŒ Ø¯Ø³Øª Ù…Ø±Ø´Ø§Øª Ø±Ø§ Ú¯Ø±ÙØª Ùˆ Ø¨Ø§ Ø¹ØµØ¨Ø§Ù†ÛŒØª Ú¯ÙØª: Â«Ø¯Ø§Ø±ÛŒ Ú†Ù‡ ØºÙ„Ø·ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØŸ ØªÙˆ ÛŒÚ© Ø¨Ø²Ø¯Ù„ÛŒ!Â»\n\nÙ…Ø±Ø´Ø§Øª: Â«Ø¯Ø³Øª Ø§Ø² Ø³Ø±Ù… ÙˆØ±Ø¯Ø§Ø± Ù‡ÙˆÙ„Ù‡ØŒ ØªÙˆ Ú†ÛŒ Ù…ÛŒâ€ŒÙÙ‡Ù…ÛŒØŸ!Â»\n\nÙ‡ÙˆÙ„Ù‡: Â«Ù…ÛŒØ®ÙˆØ§ÛŒ Ø®ÙˆØ¯ØªÙˆ Ø¨Ú©Ø´ÛŒ ØªØ§ Ø®ÛŒØ§Ù„ \"Ø§ÙˆÙ†\" Ø±Ùˆ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø§Ø¯Ø§Ù…Ù‡ Ø²Ù†Ø¯Ú¯ÛŒØ´ Ø±Ø§Ø­Øª Ú©Ù†ÛŒØŸ Ú©Ù„ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ùˆ Ú¯Ø±ÙˆÙ‡Øª Ø±Ùˆ Ø¨Ù‡ Ù‚ØªÙ„ Ø±Ø³ÙˆÙ†Ø¯ Ùˆ ØªÙˆ Ø¯Ø§Ø±ÛŒ ÙØ±Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒ... Ø®Ù†Ø¯Ù‡â€ŒØ¯Ø§Ø±Ù‡!Â»\n\nÙ…Ø±Ø´Ø§Øª Ú†Ø§Ù‚Ùˆ Ø±Ø§ Ø¢Ø±Ø§Ù… Ù¾Ø§ÛŒÛŒÙ† Ù…ÛŒâ€ŒØ¢ÙˆØ±Ø¯ Ùˆ Ù…ÛŒâ€ŒÙ†Ø´ÛŒÙ†Ø¯.`,
    choices: [
      { label: "Ø§Ø² Ú©ÛŒÙ‡ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§ÛŒØ³Ø§Ø¯ÛŒØŸ (Ù¾Ø±Ø³Ø´ + Ø¯Ø³ØªÙˆØ± Ø¬Ù…Ø¹ Ú©Ø±Ø¯Ù† Ø§ÙØ±Ø§Ø¯)", goto: "order_gather" }
    ]
  },

  "order_gather": {
    chapter:1,
    text: `Ù‡ÙˆÙ„Ù‡: Â«Ø¯Ùˆ Ø³Ø§Ø¹ØªÛŒ Ù…ÛŒØ´Ù‡.Â»\n\nÙ…Ø±Ø´Ø§Øª Ú†Ø§Ù‚Ùˆ Ø±Ø§ Ø¯Ø± Ø¬ÛŒØ¨Ø´ Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯ Ùˆ Ù…ÛŒâ€ŒÚ¯ÙˆÛŒØ¯: Â«Ø¨Ø±Ùˆ Ø¨Ú†Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ø¬Ù…Ø¹ Ú©Ù†ØŒ Ø¨Ú¯Ùˆ Ù‡Ù…Ø´ÙˆÙ† Ø¨ÛŒØ§Ù† Ø²ÛŒØ± Ø¯Ø±Ø®Øª Ú©Ù‡Ù† ØªØ§ Ø¨Ø±Ø³Ù….Â»\n\nÙ…Ø±Ø´Ø§Øª Ù…ÛŒâ€ŒØ±ÙˆØ¯ ØªØ§ Ø§Ø¹Ø¶Ø§ÛŒ Ú¯Ø±ÙˆÙ‡ \"Ø±ÛŒØªØ§Ø±Ø¯Ø¯\" Ø±Ø§ Ø¢Ø±Ø§Ù… Ú©Ù†Ø¯ØŒ Ø¯Ø± Ø­Ø§Ù„ÛŒ Ú©Ù‡ Ø®ÙˆØ¯Ø´ Ù‡ÛŒÚ† Ø¢Ø±Ø§Ù…Ø´ÛŒ Ù†Ø¯Ø§Ø´Øª. Ú¯Ù†Ú¯ Ù‚Ø¨Ù„ÛŒ Ø¨Ù‡â€ŒØ®Ø§Ø·Ø± Ø®ÛŒØ§Ù†Øª ÛŒÚ© Ø¯ÙˆØ±Ù Ø¨Ù‡ Ù†Ø§Ù… Ù…Ø§Ø¦Ø¯Ù‡ Ù†Ø§Ø¨ÙˆØ¯ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯ Ùˆ ØªÚ©â€ŒØªÚ© Ø§Ø¹Ø¶Ø§ÛŒ Ø¢Ù† Ú¯Ø±ÙˆÙ‡ Ú©Ø´ØªÙ‡ Ø´Ø¯Ù†Ø¯Ø› Ù‡Ù…Ù‡ Ø¬Ø² Ú†Ù†Ø¯ Ù†ÙØ±... Ø­Ø§Ù„Ø§ Ø§Ùˆ Ù…Ø§Ù†Ø¯Ù‡ Ø¨ÙˆØ¯ Ùˆ Ú†Ù†Ø¯ Ø¹Ø¶Ùˆ Ø¬Ø¯ÛŒØ¯ Ùˆ Ø§Ù„Ø¨ØªÙ‡ Ø¯ÙˆØªØ§ Ø§Ø² Ø²Ø®Ù…â€ŒØ®ÙˆØ±Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ: Ù‡ÙˆÙ„Ù‡ Ùˆ Ø¹Ù„â€ŒØ§Ú©Ø¨Ø±.`,
    choices: [
      { label: "Ø¨Ù‡ Ø¬Ù„Ø³Ù‡ Ø¨Ø±Ú¯Ø±Ø¯ Ùˆ Ø¨Ù†Ø´ÛŒÙ†", goto: "speech_table" }
    ]
  },

  "speech_table": {
    chapter:1,
    text: `ÙˆÙ‚ØªÙ Ø³Ø®Ù†Ø±Ø§Ù†ÛŒ Ø§Ø³Øª â€” Ø³Ø®Ù†Ø±Ø§Ù†ÛŒ Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ù…Ø´Øª Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø§Ø§Ù…ÛŒØ¯ Ùˆ Ø®Ø³ØªÙ‡ØŒ ØªÙˆØ³Ø· Ø±Ù‡Ø¨Ø± Ø®Ø³ØªÙ‡.\n\nÙ…Ø±Ø´Ø§Øª Ø±ÙØª Ùˆ Ø³Ø± Ù…ÛŒØ² Ù†Ø´Ø³Øª Ùˆ Ø´Ø±ÙˆØ¹ Ú©Ø±Ø¯ Ø¨Ù‡ ØµØ­Ø¨ØªØŒ Ø§Ù…Ø§ Ù‡Ø±Ú©Ø³ÛŒ Ø¯Ø§Ø´Øª Ø¨Ø§ Ø®ÙˆØ¯Ø´ ÙˆØ± Ù…ÛŒâ€ŒØ±ÙØª Ùˆ Ú©Ø³ÛŒ Ø§Ù‡Ù…ÛŒØª Ù†Ù…ÛŒâ€ŒØ¯Ø§Ø¯. Ù‡ÙˆÙ„Ù‡ Ù¾Ø§Ø´ Ø±Ø§ Ù…Ø­Ú©Ù… Ø±ÙˆÛŒ Ù…ÛŒØ² Ú©ÙˆØ¨ÛŒØ¯ Ùˆ Ù†ÙˆÛŒØ² Ù‚Ø·Ø¹ Ø´Ø¯Ø› Ø­Ø§Ù„Ø§ Ù‡Ù…Ù‡ Ø¨Ù‡ Ù…Ø±Ø´Ø§Øª Ù†Ú¯Ø§Ù‡ Ù…ÛŒâ€ŒÚ©Ø±Ø¯Ù†Ø¯.\n\nÙ…Ø±Ø´Ø§Øª: Â«ÛŒÚ© Ø³Ø§Ù„ Ø§Ø®ÛŒØ±ØŒ Ø¨Ø¯ØªØ±ÛŒÙ† Ø³Ø§Ù„ Ø²Ù†Ø¯Ú¯ÛŒ Ù…Ø§ Ø¨ÙˆØ¯... Ø¨Ù‡ Ù…Ø§ Ø®ÛŒØ§Ù†Øª Ø´Ø¯ Ùˆ Ø¯ÙˆØ³ØªØ§Ù† Ø²ÛŒØ§Ø¯ÛŒ Ø±Ø§ Ø§Ø² Ø¯Ø³Øª Ø¯Ø§Ø¯ÛŒÙ…...Â»`,
    choices: [
      { label: "Ù†Ø±Ù…Ø§Ù„ Ø±Ùˆ Ø§Ø² Ø¬Ù„Ø³Ù‡ Ø¨ÛŒØ±ÙˆÙ† Ú©Ù†", goto: "kick_normal" },
      { label: "Ù†Ú¯Ø§Ù‡Ø´ Ú©Ù† Ùˆ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡", goto: "look_normal_continue" }
    ]
  },

  "kick_normal": {
    chapter:1,
    text: `Ù…Ø±Ø´Ø§Øª Ø¨Ù‡ Ù†Ø±Ù…Ø§Ù„ Ù†Ú¯Ø§Ù‡ Ú©Ø±Ø¯ Ùˆ Ú¯ÙØª: Â«Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ù‡ÛŒ Ù¾Ø§Ø±Ø§Ø²ÛŒØª Ø¨Ù†Ø¯Ø§Ø²ÛŒØŒ Ø³Ú©ÙˆØª Ú©Ù† Ùˆ Ø¨ÛŒØ±ÙˆÙ† Ø¨Ø±ÙˆØ› Ùˆ Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ú©Ù…Ú© Ú©Ù†ÛŒØŒ Ø¨Ø´ÛŒÙ† Ùˆ Ø®ÙÙ‡ Ø´Ùˆ.Â»\n\nÙ†Ø±Ù…Ø§Ù„ Ø¹ØµØ¨ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø¬Ù„Ø³Ù‡ Ø±Ø§ ØªØ±Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯.`,
    choices: [
      { label: "Ø§Ø¯Ø§Ù…Ù‡ ØµØ­Ø¨Øªâ€ŒÙ‡Ø§", goto: "continue_speech_after_normal" }
    ]
  },

  "look_normal_continue": {
    chapter:1,
    text: `Ù…Ø±Ø´Ø§Øª ÛŒÚ© Ù„Ø­Ø¸Ù‡ Ù†Ø±Ù…Ø§Ù„ Ú¯Ø§Ø¨Ù„ÛŒÙ† Ø±Ø§ Ù†Ú¯Ø§Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ù†ÙØ³ Ù…ÛŒâ€ŒÚ©Ø´Ø¯ Ùˆ Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.`,
    choices: [
      { label: "Ø§Ø¯Ø§Ù…Ù‡ ØµØ­Ø¨Øªâ€ŒÙ‡Ø§", goto: "continue_speech_after_normal" }
    ]
  },

  "continue_speech_after_normal": {
    chapter:1,
    text: `Ù…Ø±Ø´Ø§Øª: Â«Ù‡Ù…ÙˆÙ†Ø·ÙˆØ± Ú©Ù‡ Ú¯ÙØªÙ…ØŒ Ø®ÛŒÙ„ÛŒ Ø¨Ù‡ Ù…Ø§ Ø®ÙˆØ´ Ù†Ú¯Ø°Ø´ØªÙ‡... Ø§Ù…Ø§ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ø§ÛŒÙ† Ù‚ØµÙ‡ Ù¾Ø§ÛŒØ§Ù† Ø¨Ø¯ÛŒÙ…! ØªØ§ \"Ø§ÙˆÙ†\" Ù†Ø±Ù‡ØŒ Ù…Ø§ Ù‡Ù…ÛŒØ´Ù‡ Ùˆ Ù‡Ù…Ù‡â€ŒØ¬Ø§ Ù†Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒÙ… Ø¨Ø§ Ø¢Ø±Ø§Ù…Ø´ Ùˆ Ø§Ù…Ù†ÛŒØª Ø¨Ø®ÙˆØ§Ø¨ÛŒÙ…. Ø§ÙˆÙ†Ø§ Ø¢Ø±Ø§Ù…Ø´ Ø±Ùˆ Ø§Ø² Ù…Ø§ Ú¯Ø±ÙØªÙ†... Ø¨Ø±Ø§Ø¯Ø± Ù…Ù† Ø¯Ø± Ø§ÛŒÙ† Ø±Ø§Ù‡ Ú©Ø´ØªÙ‡ Ø´Ø¯.Â»\n\nÙ†Ø±Ù…Ø§Ù„ Ú¯Ø§Ø¨Ù„ÛŒÙ† Ø¨Ø§ Ù„Ø­Ù† Ú©Ù†Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ú¯ÙØª: Â«Ø¨Ù†Ø¸Ø±Øª ØªÙ‚ØµÛŒØ± Ú©ÛŒ Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ø¨Ø§Ø´Ù‡ØŸÂ»`,
    choices: [
      { label: "Ø¨Ù‡Ø´ Ø¨Ú¯Ùˆ Ù‚ØµØ¯ Ø®ÙˆØ¯Ú©Ø´ÛŒ Ø¯Ø§Ø´ØªÛŒ", goto: "admit_suicide_intent" },
      { label: "Ø§Ø¯Ø§Ù…Ù‡ ØµØ­Ø¨Øªâ€ŒÙ‡Ø§ (Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù† Ø¹Ø²Ù… Ùˆ Ø±ÙØªÙ† Ø¨Ù‡ Ø¹Ù…Ù„ÛŒØ§Øª)", goto: "speech_call_to_action" }
    ]
  },

  "admit_suicide_intent": {
    chapter:1,
    text: `Ù…Ø±Ø´Ø§Øª: Â«Ù…ÛŒâ€ŒØ®ÙˆØ§Ø³ØªÙ… Ø±Ø§Ù‡Ù Ø¢Ø³ÙˆÙ† Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†Ù…ØŒ Ø§Ù…Ø§ ØªØ§ Ú©Ø§Ø±ÛŒ Ø±Ùˆ Ú©Ù‡ Ø´Ø±ÙˆØ¹ Ú©Ø±Ø¯ÛŒÙ… ØªÙ…ÙˆÙ… Ù†Ú©Ù†ÛŒÙ…... Ù‡ÛŒÚ† Ø±ÙˆØ´ÛŒ Ø¢Ø³ÙˆÙ† Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯.Â»\n\n(Ú¯Ø±ÙˆÙ‡ Ø¨Ù‡ Ø­Ø±Ù Ù…ÛŒâ€ŒØ®Ù†Ø¯Ø¯ ÛŒØ§ ÙÚ©Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯Ø› Ø§Ù…Ø§ Ø­Ø±Ù Ù…Ø±Ø´Ø§Øª Ú©Ù…ÛŒ ØªØ§Ø«ÛŒØ± Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯.)`,
    choices: [
      { label: "Ø§Ø¯Ø§Ù…Ù‡: Ø¯Ø¹ÙˆØª Ø¨Ù‡ Ø¹Ù…Ù„ÛŒØ§Øª", goto: "speech_call_to_action" }
    ]
  },

  "speech_call_to_action": {
    chapter:1,
    text: `Ù…Ø±Ø´Ø§Øª: Â«Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ø§Ù…Ù¾Ø§ÛŒØ± Ø­Ù…Ù„Ù‡ Ú©Ù†ÛŒÙ… Ùˆ Ú†Ø§Ù‚Ø²ÛŒÙˆØ§Ù„ Ø±Ùˆ ÙˆØ³Ø· Ø´Ù‡Ø± Ø§Ø¹Ø¯Ø§Ù… Ú©Ù†ÛŒÙ…. Ø§ÙˆÙ† Ù…Ù†ØªØ¸Ø± Ù†Ø®ÙˆØ§Ù‡Ø¯ Ù…Ø§Ù†Ø¯Ø› Ù¾Ø³ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ùˆ Ø¯Ø³Øª Ø¨Ù‡ Ú©Ø§Ø± Ù…ÛŒâ€ŒØ´ÙˆÛŒÙ…. Ù…Ø§ Ø¨Ø§ÛŒØ¯ Ø¢Ø±Ø§Ù…Ø´â€ŒÙ…Ø§Ù† Ø±Ø§ Ù¾Ø³ Ø¨Ú¯ÛŒØ±ÛŒÙ….Â»\n\nØ§Ø¹Ø¶Ø§ÛŒ Ú¯Ù†Ú¯ Ø¨ÛŒâ€ŒØªÙØ§ÙˆØª Ø§Ø² Ø³Ø±Ù Ø¬Ø§ÛŒØ´Ø§Ù† Ø¨Ø±Ù…ÛŒâ€ŒØ®ÛŒØ²Ù†Ø¯ Ùˆ Ù…ÛŒâ€ŒØ±ÙˆÙ†Ø¯Ø› Ù…Ø±Ø´Ø§Øª Ø¢Ù‡ÛŒ Ù…ÛŒâ€ŒÚ©Ø´Ø¯. Ù‡ÙˆÙ„Ù‡ Ø¯Ø³ØªØ´ Ø±Ø§ Ø±ÙˆÛŒ Ø´Ø§Ù†Ù‡Ù” Ù…Ø±Ø´Ø§Øª Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯ Ùˆ Ù…ÛŒâ€ŒÚ¯ÙˆÛŒØ¯: Â«Ø§Ú¯Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¯Ù„â€ŒØ´ÙˆÙ† Ø±Ùˆ Ø¨Ø¯Ø³Øª Ø¨ÛŒØ§Ø±ÛŒØŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†ÛŒÚ© Ø¯Ø§Ø±ÛŒØ› Ù…ÛŒâ€ŒÙÙ‡Ù…ÛŒØŸÂ»\n\nÙ…Ø±Ø´Ø§Øª: Â«Ø¢Ø±Ù‡... Ø­Ù‚ Ø¨Ø§ ØªÙˆØ¦Ù‡.Â»\n\nÙ¾Ø§ÛŒØ§Ù† Ù‚Ø³Ù…Øª Ø§ÙˆÙ„.`,
    choices: [
      { label: "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ", goto: "END_PART1" }
    ]
  },

  // ----- Branch B: Angry door (Ø§Ù†ØªÙ‚Ø§Ù…ÛŒ/Ø®Ø´Ù† path) -----
  "angry_door": {
    chapter:1,
    text: `Ù…Ø±Ø´Ø§Øª Ø¨Ø§ Ù„Ú¯Ø¯ Ø¯Ø± Ø±Ø§ Ø¨Ø§Ø² Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ú†Ø§Ù‚Ùˆ Ø±Ø§ Ù…Ø­Ú©Ù…â€ŒØªØ± Ø¯Ø± Ø¯Ø³Øª Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ Ú©Ù‡ Ù†Ø§Ú¯Ù‡Ø§Ù† Ø¹Ù„â€ŒØ§Ú©Ø¨Ø±ØŒ Ù…Ø±Ø¯ÛŒ Ø¨Ø§ Ø¨Ø§Ù„Ø§ ØªÙ†Ù‡Ù” Ø§Ù„Ø§Øº Ùˆ Ù†ÛŒÙ…â€ŒÙ¾Ø§ÛŒÛŒÙ† Ø´Ø¨ÛŒÙ‡ Ø§Ù†Ø³Ø§Ù†ØŒ Ø¬Ù„ÙˆÛŒØ´ Ø³Ø¨Ø² Ù…ÛŒâ€ŒØ´ÙˆØ¯: Â«Ø¹Ø·Ø´ Ø§Ù†ØªÚ¯Ø§Ù… Ø±Ùˆ Ø¯Ø± ØªÙˆ Ù…ÛŒâ€ŒØ¨ÛŒÙ†Ù…ØŒ ÙˆÙ„ÛŒ Ø§Ú¯Ù‡ ØªÙ†Ù‡Ø§ Ø¨Ø±ÛŒ Ù…Ø«Ù„ Ú¯Ù†Ú¯ Ù‚Ø¨Ù„ÛŒ Ø¨Ù‡ ÙÙ†Ø§ Ù…ÛŒâ€ŒØ±ÛŒ.Â»\n\nÙ…Ø±Ø´Ø§Øª: Â«Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¯ÛŒÚ¯Ù‡ Ú©Ø³ÛŒ Ø±Ùˆ Ø§Ø² Ø¯Ø³Øª Ù†Ø¯Ù…ØŒ Ø¨Ø§ÛŒØ¯ ØªÙ†Ù‡Ø§ Ø¨Ø±Ù…. Ø¹Ù„â€ŒØ§Ú©Ø¨Ø±ØŒ Ø¨Ø±Ùˆ Ú©Ù†Ø§Ø±.Â»\n\nØ¹Ù„â€ŒØ§Ú©Ø¨Ø±: Â«Ø¯Ù„Øª Ø¬ÙØªÚ© Ù…ÛŒâ€ŒØ®ÙˆØ§Ø¯ ØŸ Ù…Ù† Ù…ÛŒØ±Ù… Ø¬Ø±ÙˆÙ‡ Ø±Ùˆ Ø¬Ù…Ø¹ Ú©Ù†Ù… Ø²ÛŒØ± Ø¯Ø±Ø®Øª Ú©ÙˆÙ‡Ù†Ø› Ø¨ÛŒØ§ Ùˆ Ù†Ú¯Ø´Ù‡ Ø±Ø§ Ø´Ø±Ø­ Ø¨Ø¯Ù‡.Â»`,
    choices: [
      { label: "Ú©ØµÙ Ù…Ø§Ø¯Ø±Øª (Ù¾Ø§Ø³Ø® ØªÙ†Ø¯ Ùˆ ØªÙˆÙ‡ÛŒÙ†â€ŒØ¢Ù…ÛŒØ²)", goto: "insult_reply" },
      { label: "Ø§Ù‡... Ø®ÛŒÙ„ÛŒ Ø®Ø¨ (Ø¢Ø±Ø§Ù…â€ŒØªØ±ØŒ Ù‚Ø¨ÙˆÙ„ Ù‡Ù…â€ŒØ±Ø§ÛŒÛŒ)", goto: "calm_reply" }
    ]
  },

  "insult_reply": {
    chapter:1,
    text: `Ù…Ø±Ø´Ø§Øª: Â«Ú©ØµÙ Ù…Ø§Ø¯Ø±ØªØŒ Ú¯Ø§ÛŒÛŒØ¯ÛŒ. Ø¨Ø§Ø´Ù‡Ø› Ø¨Ø±Ùˆ Ùˆ Ø¬Ù…Ø´ÙˆÙ† Ú©Ù† ØªØ§ Ø¨ÛŒØ§Ù….Â»\n\n(Ø¹Ù„â€ŒØ§Ú©Ø¨Ø± Ù…ÛŒâ€ŒØ±ÙˆØ¯ Ùˆ Ú¯Ø±ÙˆÙ‡ Ø±Ø§ Ø®Ø¨Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯.)\n\nÙ…Ø±Ø´Ø§Øª Ø¨Ø¹Ø¯Ø§Ù‹ Ø³Ø± Ù…ÛŒØ² Ú©Ù†Ø§Ø± Ø¯Ø±Ø®Øª Ú©Ù‡Ù† Ù…ÛŒâ€ŒÙ†Ø´ÛŒÙ†Ø¯ Ùˆ Ø¨Ø±Ø§ÛŒ ØªÙ‚ÙˆÛŒØª Ø±ÙˆØ­ÛŒÙ‡Ù” Ú¯Ø±ÙˆÙ‡ Ø³Ø®Ù†Ø±Ø§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.`,
    choices: [
      { label: "Ø¬Ù„Ø³Ù‡: Ú†Ø§Ù‚Ùˆ Ø±Ø§ Ù¾Ø±Øª Ú©Ù† Ùˆ Ø¨Ú¯Ùˆ Ú¯ÙˆØ´ Ú©Ù†Ù‡", goto: "throw_knife" },
      { label: "Ø¬Ù„Ø³Ù‡: Ø§Ø² Ø¬Ù„Ø³Ù‡ Ø§Ø®Ø±Ø§Ø¬Ø´ Ú©Ù†", goto: "expel_normal" }
    ]
  },

  "calm_reply": {
    chapter:1,
    text: `Ù…Ø±Ø´Ø§Øª Ú©Ù…ÛŒ Ù†ÙØ³ Ù…ÛŒâ€ŒÚ©Ø´Ø¯ØŒ Ø¢Ø±Ø§Ù…â€ŒØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø¨Ù‡ Ø¹Ù„â€ŒØ§Ú©Ø¨Ø± Ù…ÛŒâ€ŒÚ¯ÙˆÛŒØ¯: Â«Ø¨Ø§Ø´Ù‡ØŒ Ø¨Ø±Ùˆ Ùˆ Ù‡Ù…Ù‡ Ø±Ùˆ Ø¬Ù…Ø¹ Ú©Ù†Ø› Ù…Ù† Ù‡Ù… Ù…ÛŒâ€ŒØ¢ÛŒÙ….Â»\n\nÙ…Ø±Ø´Ø§Øª Ø³Ø± Ù…ÛŒØ²ÛŒ Ú©Ù‡ Ø¯ÙˆØ± Ø¯Ø±Ø®Øª Ú©Ù‡Ù† Ø¨ÙˆØ¯ Ù…ÛŒâ€ŒÙ†Ø´ÛŒÙ†Ø¯ Ùˆ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ø¨Ù‡ Ø³Ø®Ù†Ø±Ø§Ù†ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ‚ÙˆÛŒØª Ø±ÙˆØ­ÛŒÙ‡Ù” Ú¯Ù†Ú¯ "Ø±ÛŒØªØ§Ø±Ø¯Ø¯".`,
    choices: [
      { label: "Ø¬Ù„Ø³Ù‡: Ú†Ø§Ù‚Ùˆ Ø±Ø§ Ù¾Ø±Øª Ú©Ù† Ùˆ Ø¨Ú¯Ùˆ Ú¯ÙˆØ´ Ú©Ù†Ù‡", goto: "throw_knife" },
      { label: "Ø¬Ù„Ø³Ù‡: Ø§Ø² Ø¬Ù„Ø³Ù‡ Ø§Ø®Ø±Ø§Ø¬Ø´ Ú©Ù†", goto: "expel_normal" }
    ]
  },

  "throw_knife": {
    chapter:1,
    text: `Ù…Ø±Ø´Ø§Øª Ú†Ø§Ù‚Ùˆ Ø±Ø§ Ù¾Ø±ØªØ§Ø¨ Ù…ÛŒâ€ŒÚ©Ù†Ø¯Ø› Ú†Ø§Ù‚Ùˆ Ú©Ù…ÛŒ Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ø³Ø± Ù†Ø±Ù…Ø§Ù„ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ù‡Ù…Ù‡ Ø¨Ø§ ØªØ¹Ø¬Ø¨ Ø¨Ù‡ Ù‡Ù… Ù†Ú¯Ø§Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯. Ù…Ø±Ø´Ø§Øª Ø¨Ø§ ØµØ¯Ø§ÛŒ Ø³Ø±Ø¯ Ú¯ÙØª: Â« Ù¾Ø§Ø±Ø§Ø²ÛŒØª Ù†Ù†Ø¯Ø§Ø² Ùˆ Ú¯ÙˆØ´ Ú©Ù† Ø¨Ø¨ÛŒÙ† Ú†ÛŒ Ù…ÛŒâ€ŒÚ¯Ù…... Ø§Ù„Ø§Ù† Ø§ØµÙ„Ø§Ù‹ Ø­Ø§Ù„Ø´Ùˆ Ù†Ø¯Ø§Ø±Ù… Ú©Ù‡ Ø´ÙˆØ®ÛŒ Ú©Ù†Ù….Â»`,
    choices: [
      { label: "Ø§Ø¯Ø§Ù…Ù‡: Ø­Ù…Ù„Ù‡ Ùˆ Ø·Ø±Ø­ Ø¹Ù…Ù„ÛŒØ§Øª", goto: "violent_plan" }
    ]
  },

  "expel_normal": {
    chapter:1,
    text: `Ù…Ø±Ø´Ø§Øª Ø¨Ø§ Ø®Ø´Ù… Ú¯ÙØª: Â«Ø§Ú¯Ù‡ Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ú¯ÙˆØ±ØªÙˆ Ø§Ø² Ø§ÛŒÙ†Ø¬Ø§ Ú¯Ù… Ú©Ù†ÛŒ Ùˆ Ø¨Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ù… Ø±Ùˆ Ø¨Ú©Ù†Ù…. Ú©Ø³ÛŒ Ø¨Ù‡ Ø²ÙˆØ± Ø¯Ø¹ÙˆØªØª Ù†Ú©Ø±Ø¯Ù‡ Ø§ÛŒÙ†Ø¬Ø§ Ú©Ù‡ ÙˆØ§Ù‚ ÙˆØ§Ù‚ Ú©Ù†ÛŒ.Â»\n\nÙ†Ø±Ù…Ø§Ù„ Ø¨Ø§ Ø¹ØµØ¨Ø§Ù†ÛŒØª Ø¬Ù„Ø³Ù‡ Ø±Ø§ ØªØ±Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯Ø› Ø¹Ù„â€ŒØ§Ú©Ø¨Ø± Ø¨Ø§ Ù†Ú¯Ø§Ù‡ ØªÛŒØ²Ø´ Ø§Ùˆ Ø±Ø§ ØªØ¹Ù‚ÛŒØ¨ Ù…ÛŒâ€ŒÚ©Ø±Ø¯.`,
    choices: [
      { label: "Ø§Ø¯Ø§Ù…Ù‡: Ø­Ù…Ù„Ù‡ Ùˆ Ø·Ø±Ø­ Ø¹Ù…Ù„ÛŒØ§Øª", goto: "violent_plan" }
    ]
  },

  "violent_plan": {
    chapter:1,
    text: `Ù…Ø±Ø´Ø§Øª: Â«Ù…Ø§ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ø§Ù…Ù¾Ø§ÛŒØ± Ø­Ù…Ù„Ù‡ Ú©Ù†ÛŒÙ… Ùˆ Ø§ÙˆÙ†Ø¬Ø§ Ø±Ø§ Ø¨Ù‡ Ø¢ØªØ´ Ø¨Ú©Ø´ÛŒÙ…Ø› Ù‚Ø¨Ù„ Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ Ú†Ø§Ù‚Ø²ÛŒÙˆØ§Ù„ Ø¯Ø³Øª Ø¨Ù‡ Ú©Ø§Ø± Ø´ÙˆØ¯. Ø§ÛŒÙ†â€ŒØ¨Ø§Ø± Ù…Ø§ Ø´Ú©Ø§Ø±Ú†ÛŒ Ù‡Ø³ØªÛŒÙ…!Â»\n\nÚ¯Ø±ÙˆÙ‡ Ù…Ø«Ù„ Ù‡Ù…ÛŒØ´Ù‡ Ø³Ø±Ø¯ Ùˆ Ø¨ÛŒâ€ŒØ­ÙˆØµÙ„Ù‡ Ø§Ø² Ø¬Ø§ Ø¨Ù„Ù†Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯Ø› Ù…Ø±Ø´Ø§Øª Ù…ÛŒâ€ŒØ¯Ø§Ù†Ø¯ ØªØ§ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø±Ø§ Ø¨Ø§Ø²Ù¾Ø³ Ù†Ú¯ÛŒØ±Ø¯ØŒ Ú†ÛŒØ²ÛŒ Ø¹ÙˆØ¶ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ø¹Ù„â€ŒØ§Ú©Ø¨Ø±: Â«ÛŒÙ‡ Ø¹Ù…Ù„ÛŒØ§Øª Ú©ÙˆÚ†ÛŒÚ© Ù…ÛŒâ€ŒØ²Ù†ÛŒÙ…ØŒ Ù¾ÛŒØ±ÙˆØ²ÛŒ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ…Ø› Ø­ØªÛŒ Ø­Ù…Ù„Ù‡ Ø¨Ù‡ Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ Ú¯Ù†Ø¯ Ù‡Ù… Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ú©Ø§ÙÛŒ Ø¨Ø§Ø´Ù‡.Â»\n\nÙ…Ø±Ø´Ø§Øª: Â«Ø¨Ø§Ø´Ù‡. Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø§Ø´ÛŒØ¯.Â»\n\n(Ù¾Ø§ÛŒØ§Ù† Ù‚Ø³Ù…Øª Ø§ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ø´Ø§Ø®Ù‡Ù” Ø®Ø´Ù† Ù†ÛŒØ².)`,
    choices: [
      { label: "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ", goto: "END_PART1" }
    ]
  },

  // END placeholder
  "END_PART1": {
    chapter:1,
    text: `Ù¾Ø§ÛŒØ§Ù† Ù‚Ø³Ù…Øª Ø§ÙˆÙ„\n\nÙ…Ù…Ù†ÙˆÙ† Ú©Ù‡ ØªØ§ Ø§ÛŒÙ†Ø¬Ø§ Ù‡Ù…Ø±Ø§Ù‡ Ø´Ø¯ÛŒ.\n\n(Ø§ÛŒÙ† Ù¾Ø§ÛŒØ§Ù† ÙÙ‚Ø· Ø®Ø§ØªÙ…Ù‡Ù” Ú†Ù¾ØªØ± Û± Ø§Ø³Øª â€” Ú†Ù¾ØªØ±Ù‡Ø§ÛŒ Ø¨Ø¹Ø¯ÛŒ Ø¨Ù‡â€ŒØ²ÙˆØ¯ÛŒ Ù…Ù†ØªØ´Ø± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.)`,
    choices: [
      { label: "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ Ùˆ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú†Ù¾ØªØ±Ù‡Ø§", goto: "MENU" }
    ]
  },

  // MENU placeholder when returning from END_PART1
  "MENU": {
    text: "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú†Ù¾ØªØ±...",
    choices: []
  }
};

// ---------- UI NODES ----------
const selectView = document.getElementById('selectView');
const storyView = document.getElementById('storyView');
const chapterLabel = document.getElementById('chapterLabel');
const textBox = document.getElementById('textBox');
const choicesEl = document.getElementById('choices');
const backBtn = document.getElementById('backBtn');
const skipBtn = document.getElementById('skipBtn');
const saveBtn = document.getElementById('saveBtn');

let current = localStorage.getItem('save_scene') || 'chapter1_start';
let typingInterval = null;
let isTyping = false;
let currentFullText = '';
let currentIndex = 0;
const TYPING_SPEED = 20; // ms per character

// Attach chapter card handlers
document.querySelectorAll('.card').forEach(card=>{
  card.addEventListener('click', ()=>{
    if (card.classList.contains('locked')) {
      // small visual feedback
      card.animate([{transform:'scale(1)'},{transform:'scale(.98)'},{transform:'scale(1)'}],{duration:160});
      return;
    }
    const ch = card.dataset.ch;
    const sceneKey = `chapter${ch}_start`;
    openScene(sceneKey);
  });
});

// Back to menu
backBtn.addEventListener('click', ()=> showSelect());

// Skip typing
skipBtn.addEventListener('click', ()=> {
  if (isTyping) finishTypingNow();
});

// Save button
saveBtn.addEventListener('click', ()=>{
  localStorage.setItem('save_scene', current);
  alert('Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
});

// Show select view
function showSelect(){
  storyView.style.display = 'none';
  selectView.style.display = 'block';
  storyView.setAttribute('aria-hidden','true');
  selectView.setAttribute('aria-hidden','false');
  // focus for keyboard users
  document.querySelector('.muted').focus?.();
}

// Open a scene
function openScene(key){
  const scene = story[key] || story['MENU'];
  current = key;
  localStorage.setItem('save_scene', current);

  // show UI
  selectView.style.display = 'none';
  storyView.style.display = 'block';
  storyView.setAttribute('aria-hidden','false');
  selectView.setAttribute('aria-hidden','true');

  chapterLabel.textContent = scene.chapter ? `ÙØµÙ„ ${scene.chapter}` : '';
  renderScene(scene);
}

// Render scene with typing
function renderScene(scene){
  // reset
  clearInterval(typingInterval);
  isTyping = true;
  choicesEl.innerHTML = '';
  textBox.textContent = '';
  currentFullText = scene.text || '';
  currentIndex = 0;

  // start typing
  typingInterval = setInterval(()=>{
    if (!isTyping) {
      // finished externally
      textBox.textContent = currentFullText;
      clearInterval(typingInterval);
      typingInterval = null;
      isTyping = false;
      showChoices(scene.choices || []);
      return;
    }

    if (currentIndex < currentFullText.length) {
      textBox.textContent += currentFullText[currentIndex++];
      // auto-scroll
      textBox.scrollTop = textBox.scrollHeight;
    } else {
      clearInterval(typingInterval);
      typingInterval = null;
      isTyping = false;
      showChoices(scene.choices || []);
    }
  }, TYPING_SPEED);
}

// Finish typing immediately
function finishTypingNow(){
  if (!isTyping) return;
  isTyping = false;
  if (typingInterval) { clearInterval(typingInterval); typingInterval = null; }
  textBox.textContent = currentFullText;
  const scene = story[current] || {};
  showChoices(scene.choices || []);
}

// Show choices
function showChoices(choices){
  choicesEl.innerHTML = '';
  if (!choices || choices.length === 0) {
    // no choices -> show a default back button
    const btn = document.createElement('div');
    btn.className = 'choice';
    btn.textContent = 'Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ';
    btn.addEventListener('click', ()=> showSelect());
    choicesEl.appendChild(btn);
    fadeInChoices();
    return;
  }

  choices.forEach((c, idx)=>{
    const btn = document.createElement('div');
    btn.className = 'choice';
    btn.textContent = c.label;
    btn.addEventListener('click', ()=>{
      // special: goto MENU returns to menu
      if (c.goto === 'MENU') { showSelect(); return; }
      openScene(c.goto);
    });
    btn.style.opacity = '0';
    choicesEl.appendChild(btn);
    // staggered fade-in
    setTimeout(()=> {
      btn.style.transition = 'all .16s ease';
      btn.style.opacity = '1';
      btn.style.transform = 'translateY(0)';
    }, 70 * idx);
  });
}

// small fade helper (not strictly necessary)
function fadeInChoices(){
  const items = choicesEl.querySelectorAll('.choice');
  items.forEach((el,i)=>{
    el.style.opacity = '0';
    el.style.transform = 'translateY(8px)';
    setTimeout(()=> {
      el.style.transition = 'all .16s ease';
      el.style.opacity = '1';
      el.style.transform = 'translateY(0)';
    }, 60 * i);
  });
}

// init: show menu (do not auto-resume; user chooses)
(function init(){
  showSelect();
})();
</script>
</body>
</html>
